{% macro render_form_field(field, label_text=None) %}
    <div class="mb-3">
        <label class="form-label">
            {{ label_text|default:field.label }}
            {% if field.field.required %}<span class="text-danger">*</span>{% endif %}
        </label>
        {{ field }}
        {% if field.errors %}
            <div class="text-danger small mt-1">
                {% for error in field.errors %}
                    <div>{{ error }}</div>
                {% endfor %}
            </div>
        {% endif %}
        {% if field.help_text %}
            <div class="form-text text-muted">{{ field.help_text }}</div>
        {% endif %}
    </div>
{% endmacro %}

{% macro render_action_buttons(edit_url, delete_url, object_name, object_id) %}
    <div class="btn-group btn-group-sm" role="group">
        <a href="{{ edit_url }}" class="btn btn-primary" title="Изменить">
            <i class="fas fa-edit"></i>
        </a>
        <form method="post" action="{{ delete_url }}" style="display: inline;">
            {% csrf_token %}
            <button type="submit" class="btn btn-outline-danger" title="Удалить"
                    onclick="return confirm('Удалить {{ object_name }}?');">
                <i class="fas fa-trash"></i>
            </button>
        </form>
    </div>
{% endmacro %}

{% macro render_table_row(item, fields, edit_url_name, delete_url_name, url_kwargs={}) %}
    <tr>
        {% for field in fields %}
            <td>{{ item|attr(field) }}</td>
        {% endfor %}
        <td>
            {% set edit_url = url(edit_url_name, **{**url_kwargs, 'pk': item.id}) %}
            {% set delete_url = url(delete_url_name, **{**url_kwargs, 'pk': item.id}) %}
            {{ render_action_buttons(edit_url, delete_url, item.name, item.id) }}
        </td>
    </tr>
{% endmacro %}

{% macro render_empty_table_row(colspan, message, icon="fas fa-inbox") %}
    <tr>
        <td colspan="{{ colspan }}" class="text-center text-muted py-3">
            <i class="{{ icon }} fa-2x mb-2"></i><br>
            {{ message }}
        </td>
    </tr>
{% endmacro %}

{% macro render_filter_select(name, choices, current_value, label_text, all_option_text="Все") %}
    <div class="filter-group">
        <label>{{ label_text }}</label>
        <select name="{{ name }}" class="filter-select">
            <option value="">{{ all_option_text }}</option>
            {% for choice in choices %}
                <option value="{{ choice.id }}" 
                        {% if current_value|stringformat:"s" == choice.id|stringformat:"s" %}selected{% endif %}>
                    {{ choice.name }}
                </option>
            {% endfor %}
        </select>
    </div>
{% endmacro %}

{% macro render_card(title, count, color="primary", icon="") %}
    <div class="card h-100 shadow-sm border-{{ color }}">
        <div class="card-header bg-{{ color }} {% if color == 'warning' %}text-dark{% else %}text-white{% endif %} text-center d-flex justify-content-between align-items-center">
            <h5 class="mb-0">
                {% if icon %}{{ icon }} {% endif %}{{ title }}
            </h5>
            <span class="badge bg-light text-dark">{{ count }}</span>
        </div>
        <div class="card-body">
            {{ caller() }}
        </div>
    </div>
{% endmacro %}
